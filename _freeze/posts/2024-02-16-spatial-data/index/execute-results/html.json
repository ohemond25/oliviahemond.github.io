{
  "hash": "dfa9a1377365b7d22abd22a55b3b5572",
  "result": {
    "markdown": "---\ntitle: \"Spatial Data Analysis\"\ndescription: \"Analyzing the spatial distribution of inland oil spills in California\"\nauthor: \"Olivia Hemond\"\ndate: 02-16-2024\nimage: fig2.png\ndraft: false\ncategories: [R, Spatial, Visualization]\nformat: \n  html:\n    code-fold: show\n    toc: true\n    number-sections: false\n    embed-resources: true\neditor: visual\ntheme: flatly\nexecute:\n  echo: true\n  message: false\n  warning: false\n---\n\n\n# Oil Spill Incidents: Spatial Data Visualization\n\n[![Oil spill cleanup at a beach in Orange County, CA. Photo credits: New York Magazine](oilspill.jpg){fig-align=\"center\"}](https://nymag.com/intelligencer/2021/10/californias-oil-leak-is-part-of-a-larger-disaster.html)\n\n## Overview\n\n### Data Summary\n\nThis analysis looks at inland oil spills across the state of California in 2008, as documented by the California Department of Fish and Wildlife Office of Spill Prevention and Response (OSPR).\n\nData source: California Department of Fish and Wildlife. Oil Spill Incident Tracking. Published Jul 29 2009. Last updated Oct 24 2023. Data download available [here](https://gis.data.ca.gov/datasets/7464e3d6f4924b50ad06e5a553d71086_0/explore?location=36.705306%2C-119.422009%2C6.74).\n\n### Purpose\n\nThis analysis had three main goals:\n\n1.  Visualize the locations of 2008 oil spills across the state of California\n\n2.  Identify which counties in the state had the highest number of oil spills that year\n\n3.  Assess whether oil spills are spatially clustered or randomly spaced across the state\n\n### Analytical Outline\n\n1.  Import and Clean Data\n    -   Read in California counties shapefile\n\n    -   Read in CSV file containing oil spill data\n\n    -   Convert oil spill dataframe to simple features object\n\n    -   Check the CRS of the counties file; set oil spill sf to same CRS\n2.  Create Interactive Map\n    -   Create map of California with points denoting oil spills\n\n    -   Make map interactive so the user can zoom and click on points\n3.  Create Choropleth Map\n    -   Spatial join the counties with the oil spill points\n\n    -   Calculate the number of oil spills in each county\n\n    -   Visualize on a static choropleth map to identify counties with highest oil spill incidences\n4.  Point Pattern Analysis\n    -   Convert oil spill observations into a spatial point pattern\n    -   Use the state of California as our observation window\n    -   Calculate actual and theoretical (complete spatial randomness) nearest neighbor distances using the G function\n    -   Plot the G function results for our observed data and the theoretical data\n\n## Import and Clean Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(sf)\nlibrary(tmap)\nlibrary(spatstat)\n```\n:::\n\n\n### Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Read in California counties\nca_counties_sf <- read_sf(here('posts', '2024-02-16-spatial-data', 'data', 'ca_counties'), layer = 'CA_Counties_TIGER2016') %>%\n  janitor::clean_names() %>% \n  select(name)\n\n### Read in oil spill csv\noil_df <- read_csv(here('posts', '2024-02-16-spatial-data', 'data', 'oil_spill.csv')) %>% \n  janitor::clean_names()\n```\n:::\n\n\n### Convert dataframe to simple features\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Convert lat-long oil dataframe to sf\noil_sf <- oil_df %>% \n  drop_na(x, y) %>% \n  st_as_sf(coords = c(\"x\", \"y\"))\n```\n:::\n\n\n### Set matching CRS\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Check CRS of counties file\n# st_crs(ca_counties_sf) # \"EPSG\", 3857\n\n### Set oil sf CRS to CRS of CA counties\nst_crs(oil_sf) <- 3857\n\n### Check CRSs are equal\n# st_crs(oil_sf) == st_crs(ca_counties_sf)\n```\n:::\n\n\n## Interactive Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### set the viewing mode to interactive\ntmap_mode(mode = 'plot')\n\ntm_shape(ca_counties_sf) +\n  tm_fill(col = \"white\") +\n  tm_shape(oil_sf) +\n  tm_dots(col = \"darkblue\")\n```\n\n::: {.cell-output-display}\n![Oil spill incidents across California in 2008. Clicking a point will reveal its incident date, location, the affected waterway, and other key information.](index_files/figure-html/fig-interactivemap-1.png){#fig-interactivemap width=672}\n:::\n:::\n\n\n## Choropleth Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Spatial join counties and oil spills\ncounties_oil_sf <- st_join(ca_counties_sf, oil_sf)\n\n### Count the number of oil spills in each county\noil_counts_sf <- counties_oil_sf %>% \n  group_by(name) %>% \n  summarize(oil_count = n())\n\n### Plot\nggplot(oil_counts_sf) +\n  geom_sf(aes(fill = oil_count)) +\n  labs(fill = \"Number of Oil Spills\") +\n  scale_fill_gradientn(colors = c(\"white\", \"lightblue\", \"blue\", \"darkblue\")) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![Oil spill incident counts per county in California in 2008. Darker blue values represent greater numbers of oil spills.](index_files/figure-html/fig-choroplethmap-1.png){#fig-choroplethmap width=672}\n:::\n:::\n\n\nThe counties with the greatest number of oil spills, in order, are Los Angeles and San Diego in Southern California, and San Mateo, Alameda, and Contra Costa in Northern California.\n\n## Point Pattern Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### Convert oil spill observations to spatial point pattern (to use with spatstat package)\noil_ppp <- as.ppp(oil_sf)\n\n### Set our observation window to be the extent of California\nca_counties_win <- as.owin(ca_counties_sf)\n\n### Create point pattern dataset\noil_full <- ppp(oil_ppp$x, oil_ppp$y, window = ca_counties_win)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### Make a sequence of distances over which you'll calculate G(r)\nr_vec <- seq(0, 20000, by = 200) \n\n### Calculate the actual and theoretical G(r) values, using 100 simulations of CSR for the \"theoretical\" outcome\ngfunction_out <- envelope(oil_full, fun = Gest, r = r_vec, nsim = 100, verbose = FALSE) \n\n### Convert output to dataframe, and pivot to tidy form\ngfunction_long <- gfunction_out %>% \n  as.data.frame() %>% \n  pivot_longer(cols = obs:hi, names_to = \"model\", values_to = \"g_val\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### Then make a graph in ggplot:\nggplot(data = gfunction_long, aes(x = r, y = g_val, group = model)) +\n  geom_line(aes(color = model)) +\n  scale_color_manual(values = c(\"red\", \"red\", \"blue\", \"black\"),\n                     name = \"\",\n                     labels = c(\"hi\" = \"High 95th Percentile\", \n                                \"lo\" = \"Low 95th Percentile\", \n                                \"theo\" = \"Theoretical Complete Spatial Randomness\", \n                                \"obs\" = \"Observed\")) +\n  labs(x = 'Distance (m)', y = 'G(r)') +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![G function for observed oil spill data (blue) in comparison with theoretical complete spatial randomness (black). Red lines indicate the 95th percentile (low and high) around the theoretical model.](index_files/figure-html/fig-gfunctionPlot-1.png){#fig-gfunctionPlot width=672}\n:::\n:::\n\n\n-   Our observed data is highly clustered, because the vast majority of points have a nearest neighbor that is *closer* than they would otherwise be in a situation with complete spatial randomness (CSR).\n-   This is shown in the above graph, since the G(r) of our observations is above the G(r) of theoretical CSR.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}